import type { Case, CaseDetail, CaseSummary } from '@/modules/cases/types';
import type { Practice } from '@/modules/practices/types';
import type { LoginResponse } from '@/modules/authentication/types';

// ─── Practices ────────────────────────────────────────────────────────────────

export const MOCK_PRACTICES: Practice[] = [
  {
    practice_id: 'prac_001',
    name: 'Metro Primary Care',
    address: '123 Main St, Suite 200, Richmond, VA 23220',
    provider_role: 'attending',
    active_cases: 14,
  },
  {
    practice_id: 'prac_002',
    name: 'Lakeview Family Medicine',
    address: '456 Oak Ave, Charlottesville, VA 22901',
    provider_role: 'attending',
    active_cases: 11,
  },
  {
    practice_id: 'prac_003',
    name: 'Coastal Urgent Care',
    address: '789 Beach Blvd, Virginia Beach, VA 23451',
    provider_role: 'supervising',
    active_cases: 7,
  },
];

// ─── Auth ─────────────────────────────────────────────────────────────────────

export const MOCK_LOGIN_RESPONSE: LoginResponse = {
  access_token: 'mock_access_token_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9',
  refresh_token: 'mock_refresh_token_dGhpcyBpcyBhIHJlZnJlc2g',
  expires_in: 3600,
  provider: {
    id: 'prov_abc123',
    email: 'dr.smith@example.com',
    first_name: 'Sarah',
    last_name: 'Smith',
    role: 'physician',
    practices: MOCK_PRACTICES.map((p) => ({
      practice_id: p.practice_id,
      name: p.name,
      role: p.provider_role,
    })),
  },
};

// ─── Cases ────────────────────────────────────────────────────────────────────

// Helpers
const now = new Date('2026-02-26T12:00:00Z');
const daysAgo = (d: number) => new Date(now.getTime() - d * 86_400_000).toISOString();
const daysFromNow = (d: number) => new Date(now.getTime() + d * 86_400_000).toISOString();
const daysAgoEndOfDay = (d: number) => {
  const date = new Date(now.getTime() - d * 86_400_000);
  date.setHours(23, 59, 59, 0);
  return date.toISOString();
};

export const MOCK_CASES: Case[] = [
  // ── Metro Primary Care (prac_001) ──────────────────────────────────────────
  {
    id: 'case_001',
    practice_id: 'prac_001',
    practice_name: 'Metro Primary Care',
    patient: { id: 'pat_001', first_name: 'John', last_name: 'Davenport', date_of_birth: '1985-03-15', mrn: 'MRN-00412' },
    type: 'follow_up',
    status: 'open',
    priority: 'high',
    subject: 'Post-surgical follow-up: knee replacement',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(6),
    updated_at: daysAgo(2),
    due_date: daysFromNow(1),
    tags: ['orthopedic', 'post-op'],
    unread_messages: 2,
  },
  {
    id: 'case_002',
    practice_id: 'prac_001',
    practice_name: 'Metro Primary Care',
    patient: { id: 'pat_002', first_name: 'Margaret', last_name: 'Holloway', date_of_birth: '1942-11-02', mrn: 'MRN-00188' },
    type: 'lab_review',
    status: 'pending_review',
    priority: 'urgent',
    subject: 'Abnormal CBC — follow up required',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(3),
    updated_at: daysAgo(1),
    due_date: daysAgoEndOfDay(1), // OVERDUE
    tags: ['hematology'],
    unread_messages: 5,
  },
  {
    id: 'case_003',
    practice_id: 'prac_001',
    practice_name: 'Metro Primary Care',
    patient: { id: 'pat_003', first_name: 'Carlos', last_name: 'Mendez', date_of_birth: '1978-06-20', mrn: 'MRN-00531' },
    type: 'prescription_refill',
    status: 'open',
    priority: 'normal',
    subject: 'Metformin refill — Type 2 DM management',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(2),
    updated_at: daysAgo(2),
    due_date: daysFromNow(5),
    tags: ['diabetes', 'chronic'],
    unread_messages: 0,
  },
  {
    id: 'case_004',
    practice_id: 'prac_001',
    practice_name: 'Metro Primary Care',
    patient: { id: 'pat_004', first_name: 'Linda', last_name: 'Okafor', date_of_birth: '1961-09-14', mrn: 'MRN-00273' },
    type: 'referral',
    status: 'in_progress',
    priority: 'high',
    subject: 'Cardiology referral — atrial fibrillation workup',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(10),
    updated_at: daysAgo(3),
    due_date: daysAgoEndOfDay(2), // OVERDUE
    tags: ['cardiology', 'afib'],
    unread_messages: 1,
  },
  {
    id: 'case_005',
    practice_id: 'prac_001',
    practice_name: 'Metro Primary Care',
    patient: { id: 'pat_005', first_name: 'Thomas', last_name: 'Whitfield', date_of_birth: '1990-01-30', mrn: 'MRN-00614' },
    type: 'initial_consult',
    status: 'open',
    priority: 'normal',
    subject: 'New patient intake — hypertension evaluation',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(1),
    updated_at: daysAgo(1),
    due_date: daysFromNow(7),
    tags: ['hypertension'],
    unread_messages: 0,
  },
  {
    id: 'case_006',
    practice_id: 'prac_001',
    practice_name: 'Metro Primary Care',
    patient: { id: 'pat_006', first_name: 'Priya', last_name: 'Nair', date_of_birth: '1975-04-22', mrn: 'MRN-00789' },
    type: 'general',
    status: 'resolved',
    priority: 'low',
    subject: 'Annual wellness check results review',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(14),
    updated_at: daysAgo(7),
    due_date: daysAgo(7),
    tags: ['preventive'],
    unread_messages: 0,
  },
  {
    id: 'case_007',
    practice_id: 'prac_001',
    practice_name: 'Metro Primary Care',
    patient: { id: 'pat_007', first_name: 'Derek', last_name: 'Ashworth', date_of_birth: '1955-12-08', mrn: 'MRN-00322' },
    type: 'lab_review',
    status: 'open',
    priority: 'urgent',
    subject: 'Elevated PSA — prostate cancer screening',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(4),
    updated_at: daysAgo(1),
    due_date: daysFromNow(0), // Due today
    tags: ['oncology-screening'],
    unread_messages: 0,
  },
  {
    id: 'case_008',
    practice_id: 'prac_001',
    practice_name: 'Metro Primary Care',
    patient: { id: 'pat_008', first_name: 'Angela', last_name: 'Byrne', date_of_birth: '1968-07-17', mrn: 'MRN-00455' },
    type: 'follow_up',
    status: 'in_progress',
    priority: 'normal',
    subject: 'Thyroid medication adjustment — hypothyroidism',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(8),
    updated_at: daysAgo(2),
    due_date: daysFromNow(3),
    tags: ['endocrine'],
    unread_messages: 0,
  },
  {
    id: 'case_009',
    practice_id: 'prac_001',
    practice_name: 'Metro Primary Care',
    patient: { id: 'pat_009', first_name: 'Samuel', last_name: 'Greenfeld', date_of_birth: '2001-08-05', mrn: 'MRN-00901' },
    type: 'initial_consult',
    status: 'open',
    priority: 'low',
    subject: 'Sports physical — college athlete clearance',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(2),
    updated_at: daysAgo(2),
    due_date: daysFromNow(10),
    tags: ['sports-medicine'],
    unread_messages: 0,
  },
  {
    id: 'case_010',
    practice_id: 'prac_001',
    practice_name: 'Metro Primary Care',
    patient: { id: 'pat_010', first_name: 'Helen', last_name: 'Kowalski', date_of_birth: '1938-02-19', mrn: 'MRN-00147' },
    type: 'prescription_refill',
    status: 'closed',
    priority: 'normal',
    subject: 'Lisinopril refill — chronic hypertension',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(20),
    updated_at: daysAgo(15),
    due_date: daysAgo(15),
    tags: ['hypertension', 'chronic'],
    unread_messages: 0,
  },
  {
    id: 'case_011',
    practice_id: 'prac_001',
    practice_name: 'Metro Primary Care',
    patient: { id: 'pat_011', first_name: 'Marcus', last_name: 'Thornton', date_of_birth: '1982-10-11', mrn: 'MRN-00567' },
    type: 'referral',
    status: 'open',
    priority: 'high',
    subject: 'GI referral — persistent abdominal pain workup',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(5),
    updated_at: daysAgo(1),
    due_date: daysFromNow(2),
    tags: ['gastroenterology'],
    unread_messages: 3,
  },
  {
    id: 'case_012',
    practice_id: 'prac_001',
    practice_name: 'Metro Primary Care',
    patient: { id: 'pat_012', first_name: 'Vivienne', last_name: 'Leclair', date_of_birth: '1995-05-28', mrn: 'MRN-00834' },
    type: 'general',
    status: 'pending_review',
    priority: 'normal',
    subject: 'Anxiety management plan — medication review',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(7),
    updated_at: daysAgo(3),
    due_date: daysFromNow(4),
    tags: ['mental-health'],
    unread_messages: 0,
  },

  // ── Lakeview Family Medicine (prac_002) ───────────────────────────────────
  {
    id: 'case_013',
    practice_id: 'prac_002',
    practice_name: 'Lakeview Family Medicine',
    patient: { id: 'pat_013', first_name: 'Robert', last_name: 'Flanagan', date_of_birth: '1959-03-03', mrn: 'MRN-01001' },
    type: 'follow_up',
    status: 'open',
    priority: 'urgent',
    subject: 'Post-MI follow-up — cardiac rehab assessment',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(3),
    updated_at: daysAgo(1),
    due_date: daysFromNow(1),
    tags: ['cardiology', 'post-MI'],
    unread_messages: 0,
  },
  {
    id: 'case_014',
    practice_id: 'prac_002',
    practice_name: 'Lakeview Family Medicine',
    patient: { id: 'pat_014', first_name: 'Sandra', last_name: 'Yamamoto', date_of_birth: '1973-08-14', mrn: 'MRN-01087' },
    type: 'lab_review',
    status: 'in_progress',
    priority: 'high',
    subject: 'HbA1c trending up — DM2 intensification needed',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(5),
    updated_at: daysAgo(1),
    due_date: daysAgoEndOfDay(3), // OVERDUE
    tags: ['diabetes'],
    unread_messages: 0,
  },
  {
    id: 'case_015',
    practice_id: 'prac_002',
    practice_name: 'Lakeview Family Medicine',
    patient: { id: 'pat_015', first_name: 'Kevin', last_name: 'Bautista', date_of_birth: '1988-12-25', mrn: 'MRN-01154' },
    type: 'prescription_refill',
    status: 'open',
    priority: 'low',
    subject: 'Sertraline refill — stable MDD',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(1),
    updated_at: daysAgo(1),
    due_date: daysFromNow(6),
    tags: ['psychiatry'],
    unread_messages: 0,
  },
  {
    id: 'case_016',
    practice_id: 'prac_002',
    practice_name: 'Lakeview Family Medicine',
    patient: { id: 'pat_016', first_name: 'Diane', last_name: 'Worthington', date_of_birth: '1949-06-30', mrn: 'MRN-01223' },
    type: 'initial_consult',
    status: 'open',
    priority: 'normal',
    subject: 'Memory concerns — cognitive screening',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(9),
    updated_at: daysAgo(4),
    due_date: daysFromNow(3),
    tags: ['neurology', 'geriatrics'],
    unread_messages: 0,
  },
  {
    id: 'case_017',
    practice_id: 'prac_002',
    practice_name: 'Lakeview Family Medicine',
    patient: { id: 'pat_017', first_name: 'Ethan', last_name: 'Prescott', date_of_birth: '2005-04-16', mrn: 'MRN-01309' },
    type: 'general',
    status: 'resolved',
    priority: 'low',
    subject: 'School immunization records update',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(18),
    updated_at: daysAgo(12),
    due_date: daysAgo(10),
    tags: ['pediatrics', 'immunization'],
    unread_messages: 0,
  },
  {
    id: 'case_018',
    practice_id: 'prac_002',
    practice_name: 'Lakeview Family Medicine',
    patient: { id: 'pat_018', first_name: 'Natalie', last_name: 'Sorensen', date_of_birth: '1980-09-07', mrn: 'MRN-01392' },
    type: 'follow_up',
    status: 'pending_review',
    priority: 'high',
    subject: 'Prenatal visit 28 weeks — GDM screening results',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(6),
    updated_at: daysAgo(2),
    due_date: daysFromNow(2),
    tags: ['obstetrics', 'GDM'],
    unread_messages: 0,
  },
  {
    id: 'case_019',
    practice_id: 'prac_002',
    practice_name: 'Lakeview Family Medicine',
    patient: { id: 'pat_019', first_name: 'Richard', last_name: 'Calabrese', date_of_birth: '1966-11-20', mrn: 'MRN-01445' },
    type: 'referral',
    status: 'open',
    priority: 'normal',
    subject: 'Pulmonology referral — chronic cough evaluation',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(4),
    updated_at: daysAgo(4),
    due_date: daysFromNow(8),
    tags: ['pulmonology'],
    unread_messages: 0,
  },
  {
    id: 'case_020',
    practice_id: 'prac_002',
    practice_name: 'Lakeview Family Medicine',
    patient: { id: 'pat_020', first_name: 'Amara', last_name: 'Diallo', date_of_birth: '1993-02-14', mrn: 'MRN-01512' },
    type: 'lab_review',
    status: 'open',
    priority: 'normal',
    subject: 'Routine lipid panel review — cardiovascular risk',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(3),
    updated_at: daysAgo(3),
    due_date: daysFromNow(4),
    tags: ['preventive', 'lipids'],
    unread_messages: 0,
  },
  {
    id: 'case_021',
    practice_id: 'prac_002',
    practice_name: 'Lakeview Family Medicine',
    patient: { id: 'pat_021', first_name: 'George', last_name: 'Pemberton', date_of_birth: '1970-07-04', mrn: 'MRN-01588' },
    type: 'prescription_refill',
    status: 'in_progress',
    priority: 'normal',
    subject: 'Atorvastatin refill — hyperlipidemia',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(2),
    updated_at: daysAgo(1),
    due_date: daysFromNow(5),
    tags: ['lipids', 'chronic'],
    unread_messages: 0,
  },
  {
    id: 'case_022',
    practice_id: 'prac_002',
    practice_name: 'Lakeview Family Medicine',
    patient: { id: 'pat_022', first_name: 'Catherine', last_name: 'Morrow', date_of_birth: '1958-01-18', mrn: 'MRN-01634' },
    type: 'initial_consult',
    status: 'open',
    priority: 'high',
    subject: 'Unexplained weight loss — oncology workup',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(7),
    updated_at: daysAgo(2),
    due_date: daysAgoEndOfDay(1), // OVERDUE
    tags: ['oncology-screening'],
    unread_messages: 4,
  },
  {
    id: 'case_023',
    practice_id: 'prac_002',
    practice_name: 'Lakeview Family Medicine',
    patient: { id: 'pat_023', first_name: 'Oscar', last_name: 'Lindqvist', date_of_birth: '2000-03-22', mrn: 'MRN-01701' },
    type: 'general',
    status: 'closed',
    priority: 'low',
    subject: 'Travel medicine consultation — vaccinations',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(25),
    updated_at: daysAgo(20),
    due_date: daysAgo(20),
    tags: ['travel-medicine'],
    unread_messages: 0,
  },

  // ── Coastal Urgent Care (prac_003) ────────────────────────────────────────
  {
    id: 'case_024',
    practice_id: 'prac_003',
    practice_name: 'Coastal Urgent Care',
    patient: { id: 'pat_024', first_name: 'Brittany', last_name: 'Hargrove', date_of_birth: '1991-05-10', mrn: 'MRN-02001' },
    type: 'initial_consult',
    status: 'open',
    priority: 'urgent',
    subject: 'Acute chest pain — rule out ACS',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(0),
    updated_at: daysAgo(0),
    due_date: daysFromNow(0), // Due today
    tags: ['cardiology', 'urgent'],
    unread_messages: 0,
  },
  {
    id: 'case_025',
    practice_id: 'prac_003',
    practice_name: 'Coastal Urgent Care',
    patient: { id: 'pat_025', first_name: 'Jerome', last_name: 'Washington', date_of_birth: '1972-08-29', mrn: 'MRN-02087' },
    type: 'follow_up',
    status: 'in_progress',
    priority: 'high',
    subject: 'Wound care follow-up — laceration repair',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(5),
    updated_at: daysAgo(2),
    due_date: daysFromNow(2),
    tags: ['wound-care'],
    unread_messages: 0,
  },
  {
    id: 'case_026',
    practice_id: 'prac_003',
    practice_name: 'Coastal Urgent Care',
    patient: { id: 'pat_026', first_name: 'Melissa', last_name: 'Strickland', date_of_birth: '1984-11-03', mrn: 'MRN-02134' },
    type: 'lab_review',
    status: 'pending_review',
    priority: 'normal',
    subject: 'Strep throat culture results',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(2),
    updated_at: daysAgo(1),
    due_date: daysFromNow(1),
    tags: ['infectious-disease'],
    unread_messages: 0,
  },
  {
    id: 'case_027',
    practice_id: 'prac_003',
    practice_name: 'Coastal Urgent Care',
    patient: { id: 'pat_027', first_name: 'Arthur', last_name: 'Flemming', date_of_birth: '1947-06-15', mrn: 'MRN-02211' },
    type: 'general',
    status: 'open',
    priority: 'high',
    subject: 'Fall injury — hip X-ray review',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(3),
    updated_at: daysAgo(3),
    due_date: daysAgoEndOfDay(1), // OVERDUE
    tags: ['geriatrics', 'orthopedic'],
    unread_messages: 0,
  },
  {
    id: 'case_028',
    practice_id: 'prac_003',
    practice_name: 'Coastal Urgent Care',
    patient: { id: 'pat_028', first_name: 'Isabella', last_name: 'Ferreira', date_of_birth: '1999-09-09', mrn: 'MRN-02298' },
    type: 'prescription_refill',
    status: 'open',
    priority: 'normal',
    subject: 'Albuterol refill — exercise-induced asthma',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(1),
    updated_at: daysAgo(1),
    due_date: daysFromNow(3),
    tags: ['pulmonology', 'asthma'],
    unread_messages: 0,
  },
  {
    id: 'case_029',
    practice_id: 'prac_003',
    practice_name: 'Coastal Urgent Care',
    patient: { id: 'pat_029', first_name: 'Nathan', last_name: 'Castellano', date_of_birth: '1977-02-28', mrn: 'MRN-02365' },
    type: 'referral',
    status: 'resolved',
    priority: 'normal',
    subject: 'Orthopedic referral — ankle sprain grade II',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(12),
    updated_at: daysAgo(8),
    due_date: daysAgo(8),
    tags: ['orthopedic', 'sports-medicine'],
    unread_messages: 0,
  },
  {
    id: 'case_030',
    practice_id: 'prac_003',
    practice_name: 'Coastal Urgent Care',
    patient: { id: 'pat_030', first_name: 'Grace', last_name: 'Ngozi', date_of_birth: '1964-04-01', mrn: 'MRN-02432' },
    type: 'initial_consult',
    status: 'open',
    priority: 'urgent',
    subject: 'Severe headache — rule out meningitis',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(0),
    updated_at: daysAgo(0),
    due_date: daysFromNow(0), // Due today
    tags: ['neurology', 'urgent'],
    unread_messages: 0,
  },
  {
    id: 'case_031',
    practice_id: 'prac_003',
    practice_name: 'Coastal Urgent Care',
    patient: { id: 'pat_031', first_name: 'Dennis', last_name: 'Hartley', date_of_birth: '1953-10-22', mrn: 'MRN-02511' },
    type: 'follow_up',
    status: 'in_progress',
    priority: 'normal',
    subject: 'UTI treatment follow-up — culture sensitivity',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(4),
    updated_at: daysAgo(2),
    due_date: daysFromNow(1),
    tags: ['urology', 'infectious-disease'],
    unread_messages: 0,
  },
  {
    id: 'case_032',
    practice_id: 'prac_002',
    practice_name: 'Lakeview Family Medicine',
    patient: { id: 'pat_032', first_name: 'Patricia', last_name: 'Nguyen', date_of_birth: '1987-07-12', mrn: 'MRN-01789' },
    type: 'general',
    status: 'open',
    priority: 'low',
    subject: 'Vitamin D deficiency — supplement dosing plan',
    assigned_provider_id: 'prov_abc123',
    created_at: daysAgo(6),
    updated_at: daysAgo(6),
    due_date: daysFromNow(14),
    tags: ['preventive'],
    unread_messages: 0,
  },
];

// ─── Case Detail (extended data for single-case view) ─────────────────────────

export const MOCK_CASE_DETAILS: Record<string, CaseDetail> = {
  case_001: {
    ...MOCK_CASES[0],
    description:
      'Patient requires 2-week post-op check following right total knee arthroplasty. Review surgical notes, assess range of motion and swelling, evaluate current pain management plan, and determine PT progress.',
    patient: {
      ...MOCK_CASES[0].patient,
      phone: '+1-555-0142',
      email: 'john.davenport@email.com',
    },
    timeline: [
      {
        id: 'evt_001',
        type: 'case_created',
        timestamp: daysAgo(6),
        actor: 'system',
        details: 'Case auto-generated from surgical discharge summary.',
      },
      {
        id: 'evt_002',
        type: 'message',
        timestamp: daysAgo(4),
        actor: 'pat_001',
        details: 'Patient reporting increased swelling and stiffness in the morning.',
      },
      {
        id: 'evt_003',
        type: 'note_added',
        timestamp: daysAgo(2),
        actor: 'prov_abc123',
        details: 'Swelling within expected post-op range. Advised elevation and ice. Continue PT.',
      },
    ],
  },
  case_002: {
    ...MOCK_CASES[1],
    description:
      'CBC returned with WBC 14.2, Hgb 9.1, platelets 82K. Requires urgent physician review and possible hematology referral. Patient is an elderly female with history of MDS.',
    patient: {
      ...MOCK_CASES[1].patient,
      phone: '+1-555-0891',
      email: 'margaret.holloway@email.com',
    },
    timeline: [
      {
        id: 'evt_004',
        type: 'case_created',
        timestamp: daysAgo(3),
        actor: 'system',
        details: 'Lab results auto-flagged for physician review.',
      },
      {
        id: 'evt_005',
        type: 'message',
        timestamp: daysAgo(2),
        actor: 'pat_002',
        details: 'Patient asking about results and next steps.',
      },
    ],
  },
};

// ─── Summary (computed from mock cases) ──────────────────────────────────────

export function computeSummary(practiceId?: string): CaseSummary {
  const filtered = practiceId ? MOCK_CASES.filter((c) => c.practice_id === practiceId) : MOCK_CASES;
  const active = filtered.filter((c) => !['resolved', 'closed'].includes(c.status));
  const nowTime = new Date(now).getTime();
  const todayEnd = new Date(now);
  todayEnd.setHours(23, 59, 59, 999);

  const overdue = active.filter((c) => c.due_date && new Date(c.due_date).getTime() < nowTime).length;
  const dueToday = active.filter((c) => {
    if (!c.due_date) return false;
    const d = new Date(c.due_date);
    return d.getTime() >= nowTime && d.getTime() <= todayEnd.getTime();
  }).length;

  const byPractice = MOCK_PRACTICES.map((p) => ({
    practice_id: p.practice_id,
    practice_name: p.name,
    count: active.filter((c) => c.practice_id === p.practice_id).length,
  }));

  return {
    total_open: active.length,
    by_priority: {
      urgent: active.filter((c) => c.priority === 'urgent').length,
      high: active.filter((c) => c.priority === 'high').length,
      normal: active.filter((c) => c.priority === 'normal').length,
      low: active.filter((c) => c.priority === 'low').length,
    },
    by_status: {
      open: active.filter((c) => c.status === 'open').length,
      in_progress: active.filter((c) => c.status === 'in_progress').length,
      pending_review: active.filter((c) => c.status === 'pending_review').length,
      resolved: active.filter((c) => c.status === 'resolved').length,
    },
    overdue,
    due_today: dueToday,
    unread_messages: active.reduce((sum, c) => sum + c.unread_messages, 0),
    by_practice: practiceId ? byPractice.filter((p) => p.practice_id === practiceId) : byPractice,
  };
}
